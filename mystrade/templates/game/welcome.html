{% extends "base.html" %}
{% load staticfiles %}
{% load url from future %}

{% block styles %}
<link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.9.1.custom.min.css' %}" />
<link rel="stylesheet" href="{% static 'css/style.css-tooltips.css' %}" />
{% endblock %}

{% block scripts %}
<script src="{% static 'jquery/jquery-1.8.2.min.js' %}"></script>
<script src="{% static 'jquery/jquery-ui-1.9.1.custom.min.js' %}"></script>
{% endblock %}

{% block content %}
	{{  user.get_profile.name|capfirst }}, welcome to MysTrade !
	<br/><br/>
	<div>Your games :<br/>
		<div class="css_table">
			<div class="css_table-row header-row">
				<div class="css_table-cell">Game</div>
				<div class="css_table-cell">Players</div>
				<div class="css_table-cell">Start date</div>
				<div class="css_table-cell">End date</div>
			</div>
			{% for game in games %}
            {% cycle 'even_color' 'odd_color' as backcolor silent %}
			<div class="css_table-row">
				<div class="css_table-cell {{ backcolor }}">
				    #{{ game.id }}, by
					{% if game.master == user %}<strong>{% endif %}{% include "common/name_or_you.html" with who=game.master %}{% if game.master == user %}</strong>{% endif %}
				</div>
				<div class="css_table-cell {{ backcolor }}"><span class="underline" data-tip="{{ game.list_of_players|join:', ' }}">{{ game.players.count }} players</span></div>
				<div class="css_table-cell {{ backcolor }}">{{ game.start_date|date:"SHORT_DATETIME_FORMAT" }}</div>
				<div class="css_table-cell {{ backcolor }}{% if game.less_than_24_hours_remaining and not game.hand_submitted %} end_warning{% endif %}">
                    {{ game.end_date|date:"SHORT_DATETIME_FORMAT" }}
                </div>
                <div class="css_table-cell {{ backcolor }}"> > </div>
                <div class="css_table-cell {{ backcolor }} centered{% if not game.is_active %} inactive{% endif %}">
                    {% if user in game.players.all %}
                        {% if game.is_closed %}<a href="{% url 'player_score' game.id %}">Show Score</a>
                        {% else %}<a href="{% url 'game' game.id %}">
                            {% if game.is_active and not game.hand_submitted %}Play !{% else %}Show Game{% endif %}
                        </a>{% endif %}
                    {% elif user == game.master or user.is_staff %}
                        <a href="{% url 'control' game.id %}">Control Board</a> | <a href="{% url 'game' game.id %}">Game Page</a>
                    {% endif %}
                </div>
                <div class="css_table-cell">
                    {% if game.is_active %}
                        {% if user in game.players.all and game.hand_submitted %}
                            <span class="helptext">hand submitted</span>
                        {% else %}
                            &nbsp;
                        {% endif %}
                    {% elif game.is_ended %}
                        <span class="helptext">game ended</span>
                    {% elif game.is_closed %}
                        <span class="helptext">game closed</span>
                    {% else %}
                        <span class="helptext">not started</span>
                    {% endif %}
                </div>
			</div>
			{% endfor %}
		</div>
	</div>
	
	{% if perms.game.add_game %}
	<br/><br/>
	<form action="{% url 'create_game' %}" method="GET">
		<input type="submit" value="Create new game"/>
	</form>
	{% endif %}
	
	<script>
    $(function() {
        $( "input[type=submit]" ).button();
    });
    </script>
{% endblock content %}