{% extends "base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}

{% block styles %}
<link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.9.1.custom.min.css' %}" />
<link rel="stylesheet" href="{% static 'jquery/jquery-ui-timepicker-addon.css' %}" />
{% endblock %}

{% block scripts %}
<script src="{% static 'jquery/jquery-1.8.2.min.js' %}"></script>
<script src="{% static 'jquery/jquery-ui-1.9.1.custom.min.js' %}"></script>
<script src="{% static 'jquery/jquery-ui-timepicker-addon.js' %}"></script>
{% endblock %}

{% block content %}
<form action="" method="post">{% csrf_token %}
	<table class="fullwidth formtable">
		<tr>
			<td colspan="2" class="header">Create new game</th>
		</tr>
		{% for err in form.non_field_errors %}
		<tr>
			<td colspan="2"><span class="errors">{{ err }}</span></td>
		</tr>
		{% endfor %}
		<tr>
			<th>{{ form.ruleset.label_tag }} :</th>
			<td>{{ form.ruleset }}&nbsp;<span class="errors">{{ form.ruleset.errors.as_text }}</span></td>
		</tr>
        <tr>
            <th>&nbsp;</th>
            <td><div class="upperhelptext" id="ruleset_description"></div></td>
        </tr>
		<tr>
			<th>{{ form.start_date.label_tag }} :</th>
			<td>{{ form.start_date|add_class:"jqueryui-datepicker"|attr:"size:17" }}&nbsp;<span class="errors">{{ form.start_date.errors.as_text }}</span></td>
		</tr>
		<tr>
			<th>{{ form.end_date.label_tag }} :</th>
			<td>{{ form.end_date|add_class:"jqueryui-datepicker"|attr:"size:17" }}&nbsp;<span class="errors">{{ form.end_date.errors.as_text }}</span></td>
		</tr>
		<tr>
			<th>{{ form.players.label_tag }} :</th>
			<td>{{ form.players|attr:"size:10" }}&nbsp;<span class="errors">{{ form.players.errors.as_text }}</span></td>
		</tr>
	</table>
	<div class="submit-button floatright">
		<input type="submit" value="Next: Select rules >>" />
	</div>
</form>

<script>
    $(function() {
        $(".jqueryui-datepicker").datetimepicker({
            showOn: "both",
            buttonImage: "{% static 'calendar.png' %}",
            buttonImageOnly: true,
            stepMinute: 15,
            minuteGrid: 15
        });

        $("input[type=submit]").button();

        var descriptions = [];
        {% for ruleset in rulesets %}
            descriptions[{{ ruleset.id }}] = "{{ ruleset.description|escape }}";
        {% endfor %}

        $("#id_ruleset").on("change", function() {
            var ruleset_id = $(this).children("option:selected").val();
            $("#ruleset_description").html(descriptions[ruleset_id]);
        });

        $("#id_ruleset").change();
    });
</script>
{% endblock content %}