{% extends "base.html" %}
{% load staticfiles %}
{% load url from future %}
{% load widget_tweaks %}

{% block styles %}
<link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.9.1.custom.min.css' %}" />
{% endblock %}

{% block scripts %}
<script src="{% static 'jquery/jquery-1.8.2.min.js' %}"></script>
<script src="{% static 'jquery/jquery-ui-1.9.1.custom.min.js' %}"></script>
<script src="{% static 'jquery/jquery.formset.min.js' %}"></script>
{% endblock %}

{% block content %}
	<form action="{% url 'scoring' %}" method="POST">{% csrf_token %}
		<div class="header">Select at most {{ session.players|length }} rule cards (including the mandatory ones) :
			<span class="floatright"><img src="{% static "select.png" %}" height="16" width="16" alt="" class="icon"/>
				<span class="dynamic_link" id="selectall">Select all</span>
			</span>
		</div>
		<div class="reminder">
			Ruleset : {{ session.ruleset }} &mdash; 
			Start date : {{ session.start_date|date:"SHORT_DATETIME_FORMAT" }} &mdash;
			End date : {{ session.end_date|date:"SHORT_DATETIME_FORMAT" }}<br/>
			Players : {{ session.players|join:", " }}
		</div>
		<div class="css_table">
		{{ formset.management_form }}
		{% for form in formset %}
			{% if forloop.first or forloop.counter0|divisibleby:"4" %}
			<div class="css_table-row">
			{% endif %}
				<div class="css_table-cell">
				  <div class="rulecard with_button">
					{{ form.card_id }}
					<div class="rulecard_name">{{ form.public_name.value }}</div>
					<div class="rulecard_desc">{{ form.description.value }}</div>
					<div class="align_to_bottom">
					  <div class="rulecard_select">
						<input type="checkbox" class="rulecard_checkbox" name="{{ form.selected_rule.html_name }}" id="id_{{ form.selected_rule.html_name }}" {% if form.selected_rule.value %}checked="checked"{% endif %} {% if form.mandatory.value %}disabled="disabled"{% endif %} />
						<label for="id_{{ form.selected_rule.html_name }}">{% if form.mandatory.value %}Mandatory{% else %}Keep{% endif %}</label>
					  </div>
					</div>
				  </div>
				</div>
			{% if forloop.counter|divisibleby:"4" or forloop.last %}
			</div>
			{% endif %}
		{% endfor %}
		</div>
		<input type="submit" value="Submit"/>
	</form>
	<script>
    $(function() {
        $('.rulecard_checkbox').button();
    });
    var selectall = true;
    $('#selectall').click(function() {
		$('.rulecard_checkbox').each(function() {
			if ($(this).attr('disabled') != 'disabled') {
				$(this).attr('checked', selectall).button('refresh');
			}
		});
		selectall = !selectall;
		$('#selectall').text(selectall ? 'Select all' : 'Deselect all');
    });
    </script>
{% endblock content %}