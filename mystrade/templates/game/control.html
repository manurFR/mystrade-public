{% extends "base.html" %}
{% load staticfiles %}
{% load url from future %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.9.1.custom.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.scoring.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'css/style.css-tooltips.css' %}" />
{% endblock %}

{% block scripts %}
    <script src="{% static 'jquery/jquery-1.8.2.min.js' %}"></script>
    <script src="{% static 'jquery/jquery-ui-1.9.1.custom.min.js' %}"></script>
{% endblock %}

{% block content %}
    <div class="header">Control board for game #{{ game }}
        <span class="floatright">&lt; <a href="{% url 'welcome' %}">Back</a></span></div>

    {% if game.is_ended %}
        <div class="reminder">This game has ended on {{ game.end_date }} ({{ game.end_date|timesince }} ago).
        {% if not game.closing_date %}
            <p>All trades have been blocked since that time.<br/>
            Please click on this button to cancel all unfinished trades, calculate scores and definitely close the game:</p>
            <div class="floatright">
                <form action="{% url 'close_game' game.id %}" method="post">{% csrf_token %}
                    <input type="submit" value="Close this game"/>
                </form>
            </div>
            <br/><br/>
        {% endif %}
        </div>
    {% elif game.is_closed %}
        <div class="reminder">This game was closed on {{ game.end_date }} ({{ game.end_date|timesince }} ago).</div>
        {% include "scoring/score.html" %}
    {% endif %}

    <div class="header">Trades</div>
    <br/>
    <div class="css_table">
        <div class="css_table-row header-row">
            <div class="css_table-cell">from</div>
            <div class="css_table-cell">to</div>
            <div class="css_table-cell">status</div>
            <div class="css_table-cell">initiated</div>
            <div class="css_table-cell">closed</div>
        </div>
    {% for trade in trades %}
        {% cycle 'even_color' 'odd_color' as color silent %}
        <div class="css_table-row{% if trade.status == 'ACCEPTED' or trade.status == 'DECLINED' %} done{% elif trade.status == 'CANCELLED' %} cancelled{% endif %}">
            <div class="css_table-cell {{ color }}">{{ trade.initiator.get_profile.name }}</div>
            <div class="css_table-cell {{ color }}">{{ trade.responder.get_profile.name }}</div>
            <div class="css_table-cell {{ color }}">
                {{ trade.status }}
                {% if trade.status == 'CANCELLED' or trade.status == 'DECLINED' %}by {% include "common/name_or_you.html" with who=trade.finalizer %}{% endif %}
            </div>
            <div class="css_table-cell {{ color }}">{{ trade.creation_date|timesince }}</div>
            <div class="css_table-cell {{ color }}">{{ trade.closing_date|timesince }}</div>
        </div>
    {% endfor %}
    </div>

    <div class="pagination">
        {% if trades.has_previous %}
            <a href="?page={{ trades.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
                Page {{ trades.number }} of {{ trades.paginator.num_pages }}
            </span>

        {% if trades.has_next %}
            <a href="?page={{ trades.next_page_number }}">next</a>
        {% endif %}
    </div>
    <br/>

    <script>
        $(function() {
            $('input[type=submit]').button();
        });
    </script>
{% endblock %}