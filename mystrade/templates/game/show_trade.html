{% extends "base.html" %}
{% load filters %}
{% load staticfiles %}
{% load url from future %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.9.1.custom.min.css' %}" />
{% endblock %}

{% block scripts %}
    <script src="{% static 'jquery/jquery-1.8.2.min.js' %}"></script>
    <script src="{% static 'jquery/jquery-ui-1.9.1.custom.min.js' %}"></script>
{% endblock %}

{% block content %}
        <div class="header">Trade for game #{{ trade.game }} (ending in {{ trade.game.end_date|timeuntil }})
            <span class="floatright">&lt; <a href="{% url 'trades' trade.game.id %}">Back</a></span></div>
        <div>Trade proposed {% if trade.initiator == user %}to: <strong>{{ trade.responder }}</strong>{% else %}by: <strong>{{ trade.initiator }}</strong>{% endif %} &mdash;
             Status : {% if trade.status == 'INITIATED' %}waiting for response
                      {% elif trade.status == 'CANCELLED' %}you cancelled it {{ trade.closing_date|timesince }} ago{% endif %}
        </div>
        <div>
            {% if trade.rules.all %}
                <h4>Rules</h4>
                <div class="css_table">
                    {% for card in trade.rules.all %}
                        {% if forloop.first or forloop.counter0|divisibleby:"4" %}
                            <div class="css_table-row">
                        {% endif %}
                    <div class="css_table-cell">
                        <div class="card">
                            <div class="card_name">{{ card.rulecard.public_name }}</div>
                            <div class="card_desc">{{ card.rulecard.description }}</div>
                        </div>
                    </div>
                    {% if forloop.counter|divisibleby:"4" or forloop.last %}
                        </div>
                    {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
            {% if trade.tradedcommodities_set.all %}
                <h4>Commodities</h4>
                <div class="css_table">
                    <div class="css_table-row">
                        {% for card in trade.tradedcommodities_set.all %}
                            <div class="css_table-cell card">
                                <div class="card_name">{{ card.commodity.commodity.name }}</div>
                                <div class="card_copies">
                                    {% for copy in card.nb_traded_cards|as_range %}
                                        <span class="minicard" style="background-color: {{ card.commodity.commodity.color }}">&nbsp;</span>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {% if trade.free_information and trade.initiator == user %}
            <div>
                <h4>Free information(s)</h4>
                {{ trade.free_information }}<br/>
            </div>
            {% endif %}
            {% if trade.comment %}
            <div>
                <h4>Comment to the other player :</h4>
                {{ trade.comment }}
            </div>
            {% endif %}
            {% if initiator == request.user and trade.status == 'INITIATED' %}
                <div class="floatright">
                    <form action="{% url 'cancel_trade' trade.game.id trade.id %}" method="post">{% csrf_token %}
                        <input type="submit" value="Cancel this trade"/>
                    </form>
                </div>
            {% endif %}
            <br/><br/><br/>
        </div>

    </form>
    <script>
        $(function() {
            $('input[type=submit]').button();
        });
    </script>

{% endblock content %}